# risc-v

Repo for some fun RISC-V projects.

## Directory Structure

- common: includes interfaces and macros used across the project
- core: contains the RTL and testbench code for the RV32I core
- design_lib: contains RTL and test code for library of basic design modules
- docs: contains project documentation
- scripts: collection of various scripts

## Quick Start

### Clone the repository

    $ git clone https://github.com/xing-benjamin/risc-v.git

### Source the setup script

    $ cd risc-v
    $ source setup.sh

This script sets the environment variable for the root directory of the repo
by calling `git rev-parse --show-toplevel`.  
**Note**: You will need to source the script again anytime you start a new shell session.

### Tools Installation

#### Icarus Verilog

[Icarus Verilog](http://iverilog.icarus.com/) is an open-source Verilog synthesis and
and simulation tool. We will use it to perform RTL compilation to *vvp assembly* format,
which is run by the `vvp` simulator.

Icarus Verilog can be installed using your favorite package manager. On macOS,
[homebrew](https://brew.sh/) is a good option.

    $ brew install icarus-verilog

#### Verilator
[Verilator](https://www.veripool.org/verilator/) is an open-source Verilog simulator
that compiles synthesizable Verilog to a C++/SystemC model. It is cycle-accurate
(i.e. not event-driven) and can only simulate 2-state logic, but it runs extremely
fast. Additionally, since the testbench is written in C++/SystemC, it can take 
advantage of object-oriented constructs to create hierarchical testbench components
and sequences.

    $ brew install verilator

#### gtkwave

[gtkwave](http://gtkwave.sourceforge.net/) is a waveform viewer that supports various
dumpfile formats, including standard Verilog value change dump (VCD) files. We will
use gtkwave for visualizing design internals and for debugging.
To install from homebrew:

    $ brew install --cask gtkwave

**Note**: Launching gtkwave from the command line may not be as simple as adding an alias
to a shell user config file. To enable launching gtkwave from the command line, follow
the steps in this [tutorial](https://ughe.github.io/2018/11/06/gtkwave-osx).

### Running a simulation

The following is an example of running a simple simulation of a testbench for module
`dl_dff`, a simple D-flip flop:

    $ cd $ROOTDIR/design_lib
    $ make dl_dff

The make command will create a build directory for compile outputs and files
generated by the simulator that will not be tracked by git.

    $ cd build
    $ gtkwave dl_dff_tb.vcd

There are also other modules in `design_lib` that can be compiled and simulated
using a similar make command. Feel free to try those out as well.

For an example of a self-checking combinational logic testbench:
    $ cd $ROOTDIR/core
    $ make alu

Like the `design_lib` modules above, there will be a VCD file generated in the 
build directory. Additionally, the checker will print info messages (or error messages,
if applicable), to alu.log. 

That's it! More details added to this README soon.